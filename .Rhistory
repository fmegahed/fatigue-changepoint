setwd("G:/My Drive/Miami/Research/2018/Amir - Changepoint Paper/Code/GitHub/fatigue-changepoint")
load(file = "./Data/RGenerated/ECPChangePointsCUSUM.RData")
str(changepoints_cusum)
?ecp::e.divisive()
RPE <- read.csv("https://github.com/fmegahed/fatigue-changepoint/blob/master/Data/Raw/RPE.csv")
View(RPE)
RPE <- read.csv("https://raw.githubusercontent.com/fmegahed/fatigue-changepoint/master/Data/Raw/RPE.csv")
knitr::opts_chunk$set(echo = TRUE)
fatigue_from_RPE_threshold <- list()
load(file = "./Data/RGenerated/CusumData.RData")
load(file = "./Data/RGenerated/ECPChangePointsCUSUM.RData")
RPE <- read.csv("https://raw.githubusercontent.com/fmegahed/fatigue-changepoint/master/Data/Raw/RPE.csv")
RPE[,1] <- RPE[,1]*60 # Convert into seconds
RatingThresh <- 13 # Based on Maman et al. 2017
i =1
fatigue_from_RPE_threshold <- list()
load(file = "./Data/RGenerated/CusumData.RData")
load(file = "./Data/RGenerated/ECPChangePointsCUSUM.RData")
RPE <- read.csv("https://raw.githubusercontent.com/fmegahed/fatigue-changepoint/master/Data/Raw/RPE.csv")
RPE[,1] <- RPE[,1]*60 # Convert into seconds
RatingThresh <- 13 # Based on Maman et al. 2017
i =1
fatigue_from_RPE_threshold <- list()
df <- get(paste0("subject",i,"_cusum"))
mcp <- changepoints_cusum[[i]] # OUtput from ECP
# Making the DF divisiable by the window size
# (i.e., we are removing the remainder so that our chunks are equally sized)
cat('####',paste0("P", i), "{-}",'\n')
df_transformed <- melt(get(paste0("subject",i,"_cusum")),
id.vars = "time.from.start",
measure.vars=c("scaled.stride.len",
"scaled.stride.height",
"stride.duration"
)
) # ggplot data needs to be tall
fatigue_from_RPE_threshold[[i]] <- min(which(RPE[,i+1]>RatingThresh))
z = ecp::e.divisive(RPE[,i+1], min.size=window.size, alpha=1)$estimates
ecpSubjChngPnt = z[2:(length(z)-1)]
subjData<-data.frame(d1=subjRating[1]*60,t1=subjRating[i+1])
assign(paste0("g",i),
ggplot(data = df_transformed,
aes(x=time.from.start, y=value, colour = variable)) +
geom_line() +
theme_bw() +
geom_line(data=subjData,aes(x=Time,y=get(paste0("Subject.",i))/0.1),colour = "gray0") +
scale_y_continuous(sec.axis = sec_axis(~.*0.1, name = "RPE")) + #((.-min(.))*15/(max(.)-min(.)))+5
scale_colour_manual(values = c("red", "green", "blue")) +
facet_wrap(~variable,nrow=3, scales = "free_y") +
ggtitle("Changepoints for the CUSUMs of the Median Filtered Data (vertical black lines) \ncompared to the RPE subjective rating based on the threshold of 13 \n(dotted vertical black line) and ECP method (dashed vertical black line) ") +
theme(legend.position="none",
#axis.text.x=element_text(angle=90,hjust=1),
plot.title = element_text(hjust = 0.5)) +
facet_wrap(~variable,nrow=3, scales = "free_y") +
geom_vline(xintercept= y$estimates) +
geom_vline(xintercept= (threshSubjChngPnt-2)*600, linetype="dotted") +
geom_vline(xintercept= (ecpSubjChngPnt-2)*600, linetype="dashed")
)
print(get(paste0("g",i)))
cat('\n')
library(ggplot2)
library(ggplot2)
load(file = "./Data/RGenerated/CusumData.RData")
load(file = "./Data/RGenerated/ECPChangePointsCUSUM.RData")
RPE <- read.csv("https://raw.githubusercontent.com/fmegahed/fatigue-changepoint/master/Data/Raw/RPE.csv")
RPE[,1] <- RPE[,1]*60 # Convert into seconds
RatingThresh <- 13 # Based on Maman et al. 2017
i =1
fatigue_from_RPE_threshold <- list()
df <- get(paste0("subject",i,"_cusum"))
mcp <- changepoints_cusum[[i]] # OUtput from ECP
# Making the DF divisiable by the window size
# (i.e., we are removing the remainder so that our chunks are equally sized)
cat('####',paste0("P", i), "{-}",'\n')
df_transformed <- melt(get(paste0("subject",i,"_cusum")),
id.vars = "time.from.start",
measure.vars=c("scaled.stride.len",
"scaled.stride.height",
"stride.duration"
)
) # ggplot data needs to be tall
fatigue_from_RPE_threshold[[i]] <- min(which(RPE[,i+1]>RatingThresh))
z = ecp::e.divisive(RPE[,i+1], min.size=window.size, alpha=1)$estimates
ecpSubjChngPnt = z[2:(length(z)-1)]
subjData<-data.frame(d1=subjRating[1]*60,t1=subjRating[i+1])
assign(paste0("g",i),
ggplot(data = df_transformed,
aes(x=time.from.start, y=value, colour = variable)) +
geom_line() +
theme_bw() +
geom_line(data=subjData,aes(x=Time,y=get(paste0("Subject.",i))/0.1),colour = "gray0") +
scale_y_continuous(sec.axis = sec_axis(~.*0.1, name = "RPE")) + #((.-min(.))*15/(max(.)-min(.)))+5
scale_colour_manual(values = c("red", "green", "blue")) +
facet_wrap(~variable,nrow=3, scales = "free_y") +
ggtitle("Changepoints for the CUSUMs of the Median Filtered Data (vertical black lines) \ncompared to the RPE subjective rating based on the threshold of 13 \n(dotted vertical black line) and ECP method (dashed vertical black line) ") +
theme(legend.position="none",
#axis.text.x=element_text(angle=90,hjust=1),
plot.title = element_text(hjust = 0.5)) +
facet_wrap(~variable,nrow=3, scales = "free_y") +
geom_vline(xintercept= y$estimates) +
geom_vline(xintercept= (threshSubjChngPnt-2)*600, linetype="dotted") +
geom_vline(xintercept= (ecpSubjChngPnt-2)*600, linetype="dashed")
)
print(get(paste0("g",i)))
cat('\n')
library(ggplot2)
library(reshape2)
load(file = "./Data/RGenerated/CusumData.RData")
load(file = "./Data/RGenerated/ECPChangePointsCUSUM.RData")
RPE <- read.csv("https://raw.githubusercontent.com/fmegahed/fatigue-changepoint/master/Data/Raw/RPE.csv")
RPE[,1] <- RPE[,1]*60 # Convert into seconds
RatingThresh <- 13 # Based on Maman et al. 2017
i =1
fatigue_from_RPE_threshold <- list()
df <- get(paste0("subject",i,"_cusum"))
mcp <- changepoints_cusum[[i]] # OUtput from ECP
# Making the DF divisiable by the window size
# (i.e., we are removing the remainder so that our chunks are equally sized)
cat('####',paste0("P", i), "{-}",'\n')
df_transformed <- melt(get(paste0("subject",i,"_cusum")),
id.vars = "time.from.start",
measure.vars=c("scaled.stride.len",
"scaled.stride.height",
"stride.duration"
)
) # ggplot data needs to be tall
fatigue_from_RPE_threshold[[i]] <- min(which(RPE[,i+1]>RatingThresh))
z = ecp::e.divisive(RPE[,i+1], min.size=window.size, alpha=1)$estimates
ecpSubjChngPnt = z[2:(length(z)-1)]
subjData<-data.frame(d1=subjRating[1]*60,t1=subjRating[i+1])
assign(paste0("g",i),
ggplot(data = df_transformed,
aes(x=time.from.start, y=value, colour = variable)) +
geom_line() +
theme_bw() +
geom_line(data=subjData,aes(x=Time,y=get(paste0("Subject.",i))/0.1),colour = "gray0") +
scale_y_continuous(sec.axis = sec_axis(~.*0.1, name = "RPE")) + #((.-min(.))*15/(max(.)-min(.)))+5
scale_colour_manual(values = c("red", "green", "blue")) +
facet_wrap(~variable,nrow=3, scales = "free_y") +
ggtitle("Changepoints for the CUSUMs of the Median Filtered Data (vertical black lines) \ncompared to the RPE subjective rating based on the threshold of 13 \n(dotted vertical black line) and ECP method (dashed vertical black line) ") +
theme(legend.position="none",
#axis.text.x=element_text(angle=90,hjust=1),
plot.title = element_text(hjust = 0.5)) +
facet_wrap(~variable,nrow=3, scales = "free_y") +
geom_vline(xintercept= y$estimates) +
geom_vline(xintercept= (threshSubjChngPnt-2)*600, linetype="dotted") +
geom_vline(xintercept= (ecpSubjChngPnt-2)*600, linetype="dashed")
)
print(get(paste0("g",i)))
cat('\n')
window.size=120
RatingThresh <- 13 # Based on Maman et al. 2017
window.size <- 120
library(ggplot2)
library(reshape2)
load(file = "./Data/RGenerated/CusumData.RData")
load(file = "./Data/RGenerated/ECPChangePointsCUSUM.RData")
RPE <- read.csv("https://raw.githubusercontent.com/fmegahed/fatigue-changepoint/master/Data/Raw/RPE.csv")
RPE[,1] <- RPE[,1]*60 # Convert into seconds
RatingThresh <- 13 # Based on Maman et al. 2017
i =1
fatigue_from_RPE_threshold <- list()
df <- get(paste0("subject",i,"_cusum"))
mcp <- changepoints_cusum[[i]] # OUtput from ECP
# Making the DF divisiable by the window size
# (i.e., we are removing the remainder so that our chunks are equally sized)
cat('####',paste0("P", i), "{-}",'\n')
df_transformed <- melt(get(paste0("subject",i,"_cusum")),
id.vars = "time.from.start",
measure.vars=c("scaled.stride.len",
"scaled.stride.height",
"stride.duration"
)
) # ggplot data needs to be tall
fatigue_from_RPE_threshold[[i]] <- min(which(RPE[,i+1]>RatingThresh))
z = ecp::e.divisive(RPE[,i+1], min.size=window.size, alpha=1)$estimates
ecpSubjChngPnt = z[2:(length(z)-1)]
subjData<-data.frame(d1=subjRating[1]*60,t1=subjRating[i+1])
assign(paste0("g",i),
ggplot(data = df_transformed,
aes(x=time.from.start, y=value, colour = variable)) +
geom_line() +
theme_bw() +
geom_line(data=subjData,aes(x=Time,y=get(paste0("Subject.",i))/0.1),colour = "gray0") +
scale_y_continuous(sec.axis = sec_axis(~.*0.1, name = "RPE")) + #((.-min(.))*15/(max(.)-min(.)))+5
scale_colour_manual(values = c("red", "green", "blue")) +
facet_wrap(~variable,nrow=3, scales = "free_y") +
ggtitle("Changepoints for the CUSUMs of the Median Filtered Data (vertical black lines) \ncompared to the RPE subjective rating based on the threshold of 13 \n(dotted vertical black line) and ECP method (dashed vertical black line) ") +
theme(legend.position="none",
#axis.text.x=element_text(angle=90,hjust=1),
plot.title = element_text(hjust = 0.5)) +
facet_wrap(~variable,nrow=3, scales = "free_y") +
geom_vline(xintercept= y$estimates) +
geom_vline(xintercept= (threshSubjChngPnt-2)*600, linetype="dotted") +
geom_vline(xintercept= (ecpSubjChngPnt-2)*600, linetype="dashed")
)
print(get(paste0("g",i)))
cat('\n')
library(ggplot2)
library(reshape2)
load(file = "./Data/RGenerated/CusumData.RData")
load(file = "./Data/RGenerated/ECPChangePointsCUSUM.RData")
RPE <- read.csv("https://raw.githubusercontent.com/fmegahed/fatigue-changepoint/master/Data/Raw/RPE.csv")
RPE[,1] <- RPE[,1]*60 # Convert into seconds
RatingThresh <- 13 # Based on Maman et al. 2017
i =1
fatigue_from_RPE_threshold <- list()
df <- get(paste0("subject",i,"_cusum"))
mcp <- changepoints_cusum[[i]] # OUtput from ECP
# Making the DF divisiable by the window size
# (i.e., we are removing the remainder so that our chunks are equally sized)
cat('####',paste0("P", i), "{-}",'\n')
df_transformed <- melt(get(paste0("subject",i,"_cusum")),
id.vars = "time.from.start",
measure.vars=c("scaled.stride.len",
"scaled.stride.height",
"stride.duration"
)
) # ggplot data needs to be tall
fatigue_from_RPE_threshold[[i]] <- min(which(RPE[,i+1]>RatingThresh))
z = ecp::e.divisive(RPE[,i+1], min.size=window.size, alpha=1)$estimates
ecpSubjChngPnt = z[2:(length(z)-1)]
subjData<-data.frame(time.from.start=RPE[,1]*60,rpe.ratings=RPE[i+1])
assign(paste0("g",i),
ggplot(data = df_transformed,
aes(x=time.from.start, y=value, colour = variable)) +
geom_line() +
theme_bw() +
geom_line(data=subjData,aes(x=Time,y=get(paste0("Subject.",i))/0.1),colour = "gray0") +
scale_y_continuous(sec.axis = sec_axis(~.*0.1, name = "RPE")) + #((.-min(.))*15/(max(.)-min(.)))+5
scale_colour_manual(values = c("red", "green", "blue")) +
facet_wrap(~variable,nrow=3, scales = "free_y") +
ggtitle("Changepoints for the CUSUMs of the Median Filtered Data (vertical black lines) \ncompared to the RPE subjective rating based on the threshold of 13 \n(dotted vertical black line) and ECP method (dashed vertical black line) ") +
theme(legend.position="none",
#axis.text.x=element_text(angle=90,hjust=1),
plot.title = element_text(hjust = 0.5)) +
facet_wrap(~variable,nrow=3, scales = "free_y") +
geom_vline(xintercept= y$estimates) +
geom_vline(xintercept= (threshSubjChngPnt-2)*600, linetype="dotted") +
geom_vline(xintercept= (ecpSubjChngPnt-2)*600, linetype="dashed")
)
print(get(paste0("g",i)))
cat('\n')
?RPE
summary(RPE)
library(dplyr)
length_non_na_ratings <- na.omit(RPE[,i+1]) %>% length()
length_non_na_ratings
View(subjData)
length_non_na_ratings <- na.omit(RPE[,i+1]) %>% length()
subjData<-data.frame(time.from.start=RPE[,1],rpe.ratings=RPE[i+1])
View(subjData)
length_non_na_ratings <- na.omit(RPE[,i+1]) %>% length()
subjData<-data.frame(time.from.start=RPE[,1],rpe.ratings=RPE[i+1])
assign(paste0("g",i),
ggplot(data = df_transformed,
aes(x=time.from.start, y=value, colour = variable)) +
geom_line() +
theme_bw() +
geom_line(data=subjData,aes(x=Time,y=get(paste0("Subject.",i))/0.1),colour = "gray0") +
scale_y_continuous(sec.axis = sec_axis(~.*0.1, name = "RPE")) + #((.-min(.))*15/(max(.)-min(.)))+5
scale_colour_manual(values = c("red", "green", "blue")) +
facet_wrap(~variable,nrow=3, scales = "free_y") +
ggtitle("Changepoints for the CUSUMs of the Median Filtered Data (vertical black lines) \ncompared to the RPE subjective rating based on the threshold of 13 \n(dotted vertical black line) and ECP method (dashed vertical black line) ") +
theme(legend.position="none",
#axis.text.x=element_text(angle=90,hjust=1),
plot.title = element_text(hjust = 0.5)) +
facet_wrap(~variable,nrow=3, scales = "free_y") +
geom_vline(xintercept= y$estimates) +
geom_vline(xintercept= (threshSubjChngPnt-2)*600, linetype="dotted") +
geom_vline(xintercept= (ecpSubjChngPnt-2)*600, linetype="dashed")
)
df_transformed <- melt(get(paste0("subject",i,"_cusum")),
id.vars = "time.from.start",
measure.vars=c("scaled.stride.len",
"scaled.stride.height",
"stride.duration"
)
) # ggplot data needs to be tall
View(df_transformed)
View(RPE)
